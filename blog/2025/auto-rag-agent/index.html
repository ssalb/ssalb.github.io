<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> From Docs to Answers: My Smolagents + Docling + DuckDB Experiment ğŸ¤– | Dr. Salvador Salazar </title> <meta name="author" content="Dr. Salvador Salazar"> <meta name="description" content="Testing smolagents, docling, and duckdb through an agent that RAGs for you."> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%9B%B8&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://ssalb.github.io/blog/2025/auto-rag-agent/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11.0.5/swiper-bundle.min.css" integrity="sha256-yUoNxsvX+Vo8Trj3lZ/Y5ZBf8HlBFsB6Xwm7rH75/9E=" crossorigin="anonymous"> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Dr. Salvador</span> Salazar </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">From Docs to Answers: My Smolagents + Docling + DuckDB Experiment ğŸ¤–</h1> <p class="post-meta"> Created in June 25, 2025 </p> <p class="post-tags"> <a href="/blog/2025"> <i class="fa-solid fa-calendar fa-sm"></i> 2025 </a> Â  Â· Â  <a href="/blog/tag/agents"> <i class="fa-solid fa-hashtag fa-sm"></i> agents</a> Â  <a href="/blog/tag/rag"> <i class="fa-solid fa-hashtag fa-sm"></i> RAG</a> Â  <a href="/blog/tag/llms"> <i class="fa-solid fa-hashtag fa-sm"></i> llms</a> Â  <a href="/blog/tag/transformers"> <i class="fa-solid fa-hashtag fa-sm"></i> transformers</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>To the surprise of no one, <strong>retrieval-augmented generation (RAG)</strong> and <strong>agents</strong> have been the biggest buzz in the AI world for over a year now. Today, you can choose from loads of libraries, vector databases, models, and frameworks to build your own applications, and more keep popping up all the time!</p> <p>Among the multitude of options, three particular new contenders caught my eye:</p> <ul> <li>Hugging Faceâ€™s <a href="https://github.com/huggingface/smolagents" rel="external nofollow noopener" target="_blank">smolagents</a>, especially their <em>code agent</em> (more on that later).</li> <li> <a href="https://duckdb.org/" rel="external nofollow noopener" target="_blank">DuckDB</a>, whichâ€”at the risk of underselling itâ€”I will be using it as an <em>OLAP SQLite</em>. Itâ€™s recently added support for a vector data type and similarity search, making it very interesting for this kind of project.</li> <li>IBMâ€™s <a href="https://docling-project.github.io/docling/" rel="external nofollow noopener" target="_blank">Docling</a>â€”a simple, flexible, and powerful document processor/parser.</li> </ul> <p>So there I was, curious about a lightweight, in-process vector DB, a promising document parser, and a new agents frameworkâ€¦ what could I possibly do with them? ğŸ¤” <strong>An agent that ingests documents and <em>RAGs</em> for you</strong> ğŸ’¡</p> <p>This article shares my first experience and impressions while building a <em>smol</em> prototype agent that ingests your documents, indexes them for retrieval, and answers questions about their content.</p> <p>Do you want to see the code? <a href="https://github.com/ssalb/auto-rag-agent" rel="external nofollow noopener" target="_blank">Hereâ€™s the repo</a> too!</p> <h2 id="the-stack">The Stack</h2> <p>This project uses several well-known packagesâ€”including <em>transformers</em> and <em>sentence-transformers</em> for LLMs and embeddings, plus <em>Gradio</em> for the UI. I wonâ€™t detail all of them here, but I want to highlight our three main players.</p> <h4 id="smolagents">Smolagents</h4> <p>Smolagents is a minimalist AI agent framework from Hugging Face. As far as I know (and I donâ€™t follow every framework), they were the first to push the idea of a <em>code agent</em> in an openâ€‘source setting. Instead of interacting with tools via JSON, the code agent writes Python code that executes tools inside a sandbox. That makes it both more flexible and more efficient, since it can tackle complex workflows in fewer steps. For example, it could execute something like the following in a single step:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">result_1</span> <span class="o">=</span> <span class="nf">tool_1</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="k">if</span> <span class="n">result_1</span><span class="p">:</span>
    <span class="n">result_2</span> <span class="o">=</span> <span class="nf">tool_2</span><span class="p">(</span><span class="n">result_1</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">result_2</span><span class="p">)</span>
</code></pre></div></div> <p>Like most HF projects, itâ€™s modelâ€‘agnosticâ€”you can plug in your favorite LLM (openâ€‘source or APIâ€‘based) and it integrates seamlessly with the <em>transformers</em> library.</p> <p>At the time of writing, theyâ€™ve also added Visionâ€“Language models (VLMs) and <em>Computer Use</em> support in the last few weeks, opening up even more possibilities ğŸš€</p> <h4 id="docling">Docling</h4> <p>I donâ€™t think Docling has received the hype it deserves. IBM openâ€‘sourced it a while back, yet I havenâ€™t seen many people talking about it. Out of the box, it takes tons of document formats and parses them into JSON or Markdown. What used to require multiple libraries and custom parsers is now a oneâ€‘stop shop. Itâ€™s so straightforward that I barely had to tweak anything ğŸ˜…â€”which says a lot about its defaults.</p> <p>You can also supercharge it with VLMs, though I found the outâ€‘ofâ€‘theâ€‘box pipeline already covers the â€œ80%â€ of most RAG needs.</p> <h4 id="duckdb">DuckDB</h4> <p>DuckDB delivered exactly what it promised: an inâ€‘process OLAP databaseâ€”think â€œSQLite for analyticsâ€â€”and it recently added experimental support for fixedâ€‘size arrays and vector similarity search. That means you can store embeddings directly in a column and run nearestâ€‘neighbor queries with plain SQL.</p> <p>With the <code class="language-plaintext highlighter-rouge">vss</code> extension, building an <code class="language-plaintext highlighter-rouge">HNSW</code> index and performing similarity search takes just a few lines. No servers, no extra services, just a local file and your queries. For this prototype, that meant everything stayed selfâ€‘contained: ingest, embed, store, and search. Super convenient.</p> <h2 id="building-the-rag-agent">Building the RAG Agent</h2> <p>The core idea is simple:</p> <ul> <li>A chat UI built on Gradio</li> <li>A code agent following the <a href="https://www.ibm.com/think/topics/react-agent" rel="external nofollow noopener" target="_blank">ReAct framework</a> </li> <li> <p>Two initial tools:</p> <ol> <li> <strong>Indexer</strong>: ingests, parses, and indexes documents</li> <li> <strong>Retriever</strong>: embeds queries and performs similarity search</li> </ol> </li> </ul> <p>During a conversation, the user can ask the agent to index new documentsâ€”either by upload or URLâ€”or to answer questions about any indexed content.</p> <p>In practice (no surprise to anyone building agents), it didnâ€™t work perfectly at first. For this reason I ended up adding a third tool:</p> <ol> <li> <strong>Summarizer</strong>: condenses one or more text chunks, either generally or tailored to a query.</li> </ol> <p>All tools are invoked via generated Python code. The same LLM powers both the agentâ€™s reasoning and the summarization, keeping the architecture simple.</p> <h3 id="indexing">Indexing</h3> <p>For each document, the indexer:</p> <ol> <li> <strong>Parses</strong> the file with Docling</li> <li> <strong>Extracts named entities</strong> via an NERâ€‘tuned model</li> <li> <strong>Computes</strong> an embedding vector</li> <li> <p><strong>Inserts</strong> a row per chunk into DuckDB, storing:</p> <ul> <li>Document name</li> <li>Chunk text</li> <li>Named entities</li> <li>Embedding vector</li> </ul> </li> </ol> <h3 id="retrieval">Retrieval</h3> <p>The retriever:</p> <ol> <li> <strong>Extracts named entities</strong> from the query</li> <li> <strong>Embeds</strong> the query</li> <li> <strong>Retrieves</strong> chunks via similarity search (optionally filtered by document name)</li> <li> <strong>Reranks</strong> based on shared named entities between chunk and query</li> </ol> <p>This quick entityâ€‘based reranking boosted relevance without requiring expensive crossâ€‘encoders or reranker models. Itâ€™s not perfect, but itâ€™s surprisingly effective. An obvious but much more intricate extension to this approach would be to build a knowledge graph using these names entities.</p> <h2 id="observations--takeaways">Observations &amp; Takeaways</h2> <p>While I hinted at a few challenges above, the overall experience with these tools has been very positive. Here are my main takeaways:</p> <swiper-container keyboard="true" navigation="true" pagination="true" pagination-clickable="true" pagination-dynamic-bullets="true" rewind="true"> <swiper-slide> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/blog/2025-06-25-auto-rag/slider-1-480.webp 480w,/assets/img/blog/2025-06-25-auto-rag/slider-1-800.webp 800w,/assets/img/blog/2025-06-25-auto-rag/slider-1-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/blog/2025-06-25-auto-rag/slider-1.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </swiper-slide> <swiper-slide> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/blog/2025-06-25-auto-rag/slider-2-480.webp 480w,/assets/img/blog/2025-06-25-auto-rag/slider-2-800.webp 800w,/assets/img/blog/2025-06-25-auto-rag/slider-2-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/blog/2025-06-25-auto-rag/slider-2.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </swiper-slide> <swiper-slide> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/blog/2025-06-25-auto-rag/slider-3-480.webp 480w,/assets/img/blog/2025-06-25-auto-rag/slider-3-800.webp 800w,/assets/img/blog/2025-06-25-auto-rag/slider-3-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/blog/2025-06-25-auto-rag/slider-3.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </swiper-slide> <swiper-slide> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/blog/2025-06-25-auto-rag/slider-4-480.webp 480w,/assets/img/blog/2025-06-25-auto-rag/slider-4-800.webp 800w,/assets/img/blog/2025-06-25-auto-rag/slider-4-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/blog/2025-06-25-auto-rag/slider-4.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </swiper-slide> </swiper-container> <h4 id="agent-bias-toward-tool-usage">Agent bias toward tool usage</h4> <p>By default, the code agent strongly prefers using toolsâ€”even inventing themâ€”instead of solving tasks directly as an LLM. To work around this, you can tweak the system prompt or add deliberately goofy tools. I opted for the latter, introducing the <strong>summarizer</strong>. This played to the agentâ€™s toolâ€‘centric tendencies while leveraging the LLMâ€™s strengths in summarization.</p> <h4 id="model-size-matters">Model size matters</h4> <p>Earlier this year, I wrote about <a href="https://ssalb.github.io/blog/2025/test-time-compute-story-generation/">testâ€‘time compute</a> and how smaller LLMs can outperform expectations. In this case, though, model size really did matter. Models in the ~7Bâ€“11B range struggled with openâ€‘ended tasks, needing explicit instructions to use specific tools. Swapping up to ~30Bâ€“70B turned that around: the larger models handled ambiguous requests and selfâ€‘corrected much better. The tradeâ€‘off was losing local inferencing and moving to cloud endpoints.</p> <h4 id="final-verdict">Final verdict</h4> <p>All in all, I came away with a positive impression of the three tools that motivated this project. Docling is incredibly simple yet powerful â€”Iâ€™ll definitely reach for it again when processing documents. DuckDB is great, but I see its real potential more as a Delta Lake alternative than for simple, local storage (see their <a href="https://duckdb.org/2025/05/27/ducklake.html" rel="external nofollow noopener" target="_blank">Duck Lake post</a>). And smolagents? Iâ€™m excited to take it beyond this PoC, especially if async support is added. Itâ€™s shaping up to be a solid production contender.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/mini-evolve/">Evolving Code at Test Time â€” Building a Mini AlphaEvolve on My Laptop</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/cgan-class-balancer/">A Conditional GAN for Data Augmentation: A Cautionary Tale</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/test-time-compute-story-generation/">Test-Time Compute: My Take on Story Generation</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/company-no-ml/">If your company is not doing ML, it (probably) wonâ€™t start any time soon either</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> Â© Copyright 2025 Dr. Salvador Salazar. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?70d799092f862ad98c7876aa47712e20"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/swiper@11.0.5/swiper-element-bundle.min.js" integrity="sha256-BPrwikijIybg9OQC5SYFFqhBjERYOn97tCureFgYH1E=" crossorigin="anonymous"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>